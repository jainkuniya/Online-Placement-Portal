{% extends "base.html" %}
{% block title %}Companies{% endblock %}
{% block body %}
<div id="Unverified" class="tabcontent">
   <div class="container" id="form1">
      <div class="col-xs-12" id="1">
         <div class="col-xs-3"><a style="font-weight:bold;">S.No</a></div>
         <div class="col-xs-3"><a style="font-weight:bold;">Company Name</a></div>
         <div class="col-xs-6"><a style="font-weight:bold;">Action</a></div>
      </div>
      <hr>
      {% for po in positions %}
      <div class="col-xs-12" id="1">
         <div class="col-xs-3"><a>{{ loop.index }}</a></div>
         <div class="col-xs-3"><a>{{ po.companyName }}</a></div>
         <div class="col-xs-6">
            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal_{{ loop.index }}">View</button>
            <div class="modal fade" id="myModal_{{ loop.index }}" role="dialog">
               <div class="modal-dialog">
                  <div class="modal-content">
                     <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">{{ po.companyName }} Details</h4>
                     </div>
                     <div class="modal-body">
                        {% for p in po.positions %}
                          <p>Position Title: </p>
                          {{ p.position.title }}
                          <br>
                          <p>Description: </p>
                          {{ p.position.description }}
                          <p>CTC: </p>
                          {{ p.position.ctc }}
                          <p>Position Type: </p>
                          {{ p.position.position_type }}
                          <hr>

                          {% if p.status == "can_apply" %}
                            <button type="button" class="btn btn-success" onClick="applyForPosition('{{ p.code }}', '{{ po.companyCode }}')">Apply</button></div>
                          {% else %}
                            <p>Status: {{ p.status }}</p>
                          {% endif %}
                        {% endfor %}
                        <div class="modal-footer"><button type="button" class="btn btn-success" data-dismiss="modal">Close</button></div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <hr>
      </div>
      {% endfor %}
      <hr>
   </div>
</div>

<script>
function applyForPosition(pCode, cCode) {
  $('#id_error').text('');

  var data = JSON.stringify({
    pCode: pCode,
    cCode: cCode,
  });

  $.ajax({
    type: 'POST',
    url: '/api/v1/apply_for_position',
    contentType: 'application/json',
    data: data,
    success: function(result) {
      if (result.success === 1) {
        $('#id_error').text(result.message);
        $(location).attr('href', './companies');
      } else if (result.success === -99) {
        $(location).attr('href', './logout');
      } else {
        $('#id_error').text(result.message);
      }
    },
    error: function(XMLHttpRequest, textStatus, errorThrown) {
      $('#id_error').text('Error: ' + errorThrown);
    },
  });
  return false;
}
</script>
{% endblock %}
